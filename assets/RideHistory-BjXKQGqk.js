import{_ as O,i as W,r as h,w as G,o as K,g as Q,c as a,j as w,b as e,R as X,d as p,k as Z,n as P,e as $,F as N,l as H,t as i,m as C,p as R,h as n,q as A}from"./index-Cq6E6ki2.js";const I=(j,x)=>{if(!j)return"";const l=new Date(j);if(isNaN(l.getTime()))return"";switch(x){case"HH:mm":return`${String(l.getHours()).padStart(2,"0")}:${String(l.getMinutes()).padStart(2,"0")}`;case"MMM DD, YYYY":const b=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][l.getMonth()],_=l.getDate(),F=l.getFullYear();return`${b} ${_}, ${F}`;default:return l.toLocaleString()}},ee={class:"min-h-screen bg-white px-6 pt-6 pb-20",style:{"max-width":"420px",margin:"0 auto"}},te={class:"w-6 h-6 text-primary"},se={class:"flex border-b border-gray-200 mb-6"},oe={key:0},re={key:0,class:"flex justify-center items-center py-8"},le={key:1,class:"text-center text-gray-500 py-6 border border-gray-200 rounded-xl"},ae={key:2,class:"space-y-4"},ne={key:0,class:"flex flex-col"},ie={class:"flex justify-between items-start mb-3"},de={class:"text-base font-medium text-[#303030]"},ue={class:"flex items-center gap-4 mb-3"},ce={class:"text-base font-semibold text-[#303030] w-14 text-left"},ve={class:"flex flex-col justify-between h-14 ml-2"},fe={class:"text-sm font-medium text-[#303030] text-left"},ge={class:"text-sm font-medium text-[#303030] text-left"},pe={class:"flex justify-end gap-2 mt-2"},xe=["onClick"],me=["onClick"],ye={key:1,class:"flex flex-col"},he={class:"flex justify-between items-start mb-3"},be={class:"text-base font-medium text-[#303030]"},Fe={class:"flex items-center gap-4 mb-3"},we={class:"text-base font-semibold text-[#303030] w-14 text-left"},Ce={class:"flex flex-col justify-between h-14 ml-2"},_e={class:"text-sm font-medium text-[#303030] text-left"},De={class:"text-sm font-medium text-[#303030] text-left"},ke={class:"mt-2 text-sm text-gray-500"},Pe={class:"flex justify-end mt-2"},$e=["onClick"],Re={key:1},Ue={key:0,class:"flex justify-center items-center h-64"},je={key:1,class:"text-center text-red-500 p-8"},Me={key:2,class:"text-center p-8"},Ae={key:3,class:"space-y-4"},Te={class:"flex justify-end items-start mb-3"},qe={class:"flex items-center gap-4 mb-3"},ze={class:"text-base font-semibold text-[#303030] w-14 text-left"},Ne={class:"flex flex-col justify-between h-14 ml-2"},He={class:"text-sm font-medium text-[#303030] text-left"},Ie={class:"text-sm font-medium text-[#303030] text-left"},Le={class:"flex justify-between items-center text-sm text-[#8C8C8C]"},Se={key:0,class:"text-right"},Ye={key:0},Ve={key:0},Be={key:1},Ee=["onClick"],Je=["onClick"],Oe={key:4,class:"mt-6 flex justify-center items-center"},We={class:"flex items-center bg-gray-100 rounded-full p-1 shadow-sm"},Ge=["disabled"],Ke={class:"px-3 py-1 text-sm font-medium text-gray-700"},Qe=["disabled"],Xe={__name:"RideHistory",setup(j){const x=Q(),l=W(),m=h([]),b=h([]),_=h(!1),F=h(!1),c=h(null),d=h({currentPage:1,totalPages:1,nextPage:!1,prevPage:null}),f=h("history"),D=async()=>{var r,t,u;_.value=!0,c.value=null;try{if(l.isAuthenticated&&(!l.currentUser||!l.currentUser.id)&&(console.log("User info missing but authenticated. Attempting to refresh profile..."),await l.fetchUserProfile(),console.log("Refreshed user profile:",l.currentUser)),!l.isAuthenticated||!l.currentUser){console.error("User not authenticated. Redirecting to login..."),c.value="Please log in to view your ride history.",setTimeout(()=>x.push("/login"),2e3);return}const o=await R.get("/rides/user-history",{params:{page:d.value.currentPage,role:((r=l.currentUser)==null?void 0:r.role)||"passenger"}});m.value=o.data.rides,console.log("Loaded ride history:",m.value),console.log("Ride statuses:",m.value.map(v=>({id:v.rideID,status:v.status}))),d.value.currentPage=o.data.page,d.value.totalPages=o.data.total_pages,d.value.nextPage=o.data.page<o.data.total_pages,d.value.prevPage=o.data.page>1}catch(o){console.error("Error loading ride history:",o),((t=o.response)==null?void 0:t.status)===401||((u=o.response)==null?void 0:u.status)===403?(c.value="Authentication error. Please try logging in again.",setTimeout(()=>{l.logout(),x.push("/login")},2e3)):c.value="Failed to load ride history. Please try again."}finally{_.value=!1}},U=async()=>{var r,t,u;F.value=!0;try{let o=l.currentUser;if(console.log("Current user state:",o),console.log("User ID:",o==null?void 0:o.id),console.log("User role:",o==null?void 0:o.role),l.isAuthenticated&&(!o||!o.id)&&(console.log("User info missing but authenticated. Attempting to refresh profile..."),o=await l.fetchUserProfile(),console.log("Refreshed user profile:",o)),!o||!o.id){console.error("User information not available. Check if user is logged in properly."),c.value="Please log in to view your ride requests.",F.value=!1;return}const v=o.id,s=o.role||"passenger";let g="";s==="driver"?g=`/rides/driver/${v}/requests`:g=`/rides/passenger/${v}/requests`,console.log(`Making request to: ${g} for user ID: ${v} with role: ${s}`);const y=await R.get(g);b.value=y.data.requests||[]}catch(o){console.error("Error loading ride requests:",o),console.error("Error details:",((r=o.response)==null?void 0:r.data)||o.message),((t=o.response)==null?void 0:t.status)===401||((u=o.response)==null?void 0:u.status)===403?(c.value="Authentication error. Please try logging in again.",setTimeout(()=>{l.logout(),x.push("/login")},2e3)):c.value="Failed to load ride requests. Please try again.",b.value=[]}finally{F.value=!1}},T=async(r,t,u)=>{try{u==="accepted"?await R.post("/rides/requests/approve",{rideID:r,passengerID:t}):await R.post("/rides/requests/reject",{rideID:r,passengerID:t}),U()}catch(o){console.error(`Error ${u} request:`,o),alert(`Failed to ${u} request. Please try again.`)}},L=async r=>{try{await R.post(`/rides/${r}/cancel`),U()}catch(t){console.error("Error cancelling request:",t),alert("Failed to cancel request. Please try again.")}},S=()=>{d.value.nextPage&&(d.value.currentPage++,D())},Y=()=>{d.value.currentPage>1&&(d.value.currentPage--,D())},M=r=>r?I(r,"HH:mm"):"",V=r=>r?I(r,"MMM DD, YYYY"):"",B=r=>r?{pending:"Pending",approved:"Approved",accepted:"Accepted",active:"Active",completed:"Completed",cancelled:"Cancelled",rejected:"Rejected"}[r.toLowerCase()]||r:"",E=r=>r?{pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",accepted:"bg-blue-100 text-blue-800",active:"bg-green-100 text-green-800",completed:"bg-gray-100 text-gray-800",cancelled:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"}[r.toLowerCase()]||"bg-gray-100 text-gray-800":"",q=r=>{x.push({path:`/ride/${r.rideID||r.id}`,query:{from_history:"true"}})};return G(f,r=>{r==="history"?D():r==="pending"&&U()}),K(async()=>{if(console.log("RideHistory component mounted"),l.isAuthenticated||(console.log("User not authenticated, initializing auth..."),l.initializeAuth()),l.token&&(!l.currentUser||!l.currentUser.id)){console.log("We have a token but missing user data, fetching profile...");try{await l.fetchUserProfile(),console.log("User profile after refresh:",l.currentUser)}catch(r){console.error("Failed to fetch user profile:",r),c.value="Authentication error. Please try logging in again.",setTimeout(()=>{l.logout(),x.push("/login")},2e3);return}}f.value==="history"?D():U()}),(r,t)=>{var o,v;const u=Z("font-awesome-icon");return n(),a("div",null,[w(X),e("div",ee,[e("button",{class:"absolute top-6 left-6 w-10 h-10 flex items-center justify-center rounded-lg bg-[#F5F5F5] z-20 border border-gray-200",onClick:t[0]||(t[0]=s=>r.$router.back()),"aria-label":"Back"},[e("span",te,[w(u,{icon:"fa-arrow-left",class:"text-[#C77DFF]"})])]),t[23]||(t[23]=e("div",{class:"mb-6 pt-8"},[e("h1",{class:"text-2xl font-bold text-left text-[#303030] mb-2"},"Ride History"),e("p",{class:"text-[#8C8C8C] text-left"}," View all your past and upcoming rides ")],-1)),e("div",se,[e("button",{onClick:t[1]||(t[1]=s=>f.value="history"),class:P(["py-2 px-4 font-medium text-sm focus:outline-none",f.value==="history"?"text-[#C77DFF] border-b-2 border-[#C77DFF]":"text-gray-500 hover:text-[#C77DFF]"])}," Ride History ",2),e("button",{onClick:t[2]||(t[2]=s=>f.value="pending"),class:P(["py-2 px-4 font-medium text-sm focus:outline-none",f.value==="pending"?"text-[#C77DFF] border-b-2 border-[#C77DFF]":"text-gray-500 hover:text-[#C77DFF]"])}," Pending Requests ",2),t[7]||(t[7]=e("div",{class:"flex-grow"},null,-1)),e("button",{onClick:t[3]||(t[3]=s=>r.$router.push("/ride-filter")),class:"py-2 px-4 font-medium text-sm focus:outline-none text-[#C77DFF] hover:bg-[#F8F0FF] rounded-md"},[w(u,{icon:"fa-filter",class:"mr-1"}),t[6]||(t[6]=$(" Filter "))])]),f.value==="pending"?(n(),a("div",oe,[F.value?(n(),a("div",re,t[8]||(t[8]=[e("svg",{class:"animate-spin h-8 w-8 text-[#C77DFF]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1)]))):b.value.length===0?(n(),a("div",le," No pending ride requests ")):(n(),a("div",ae,[(n(!0),a(N,null,H(b.value,(s,g)=>{var y;return n(),a("div",{key:g,class:"border border-gray-200 rounded-xl p-4 shadow-sm"},[((y=C(l).currentUser)==null?void 0:y.role)==="driver"?(n(),a("div",ne,[e("div",ie,[e("div",null,[e("div",de,i(s.passengerName),1),t[9]||(t[9]=e("div",{class:"text-xs text-gray-500"},"wants to join your ride",-1))]),t[10]||(t[10]=e("span",{class:"text-xs rounded-full px-3 py-1 bg-yellow-100 text-yellow-800 font-medium"}," Pending ",-1))]),e("div",ue,[e("div",ce,i(M(s.requestTime)),1),t[12]||(t[12]=A('<div class="flex flex-col items-center justify-center h-14 relative" data-v-e1159576><div class="w-1 h-14 bg-[#C77DFF] absolute left-1/2 top-0 -translate-x-1/2 z-0" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div><div class="flex-1" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div></div>',1)),e("div",ve,[e("div",fe,i(s.startingLocation),1),t[11]||(t[11]=e("div",{class:"flex-1"},null,-1)),e("div",ge,i(s.dropoffLocation),1)])]),e("div",pe,[e("button",{onClick:k=>T(s.rideID,s.passengerID,"accepted"),class:"px-4 py-2 bg-[#C77DFF] text-white rounded-full text-sm"}," Accept ",8,xe),e("button",{onClick:k=>T(s.rideID,s.passengerID,"rejected"),class:"px-4 py-2 border border-red-500 text-red-500 rounded-full text-sm"}," Reject ",8,me)])])):(n(),a("div",ye,[e("div",he,[e("div",null,[e("div",be,"Ride to "+i(s.dropoffLocation),1),t[13]||(t[13]=e("div",{class:"text-xs text-gray-500"},"Request pending driver approval",-1))]),t[14]||(t[14]=e("span",{class:"text-xs rounded-full px-3 py-1 bg-yellow-100 text-yellow-800 font-medium"}," Pending ",-1))]),e("div",Fe,[e("div",we,i(M(s.requestTime)),1),t[16]||(t[16]=A('<div class="flex flex-col items-center justify-center h-14 relative" data-v-e1159576><div class="w-1 h-14 bg-[#C77DFF] absolute left-1/2 top-0 -translate-x-1/2 z-0" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div><div class="flex-1" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div></div>',1)),e("div",Ce,[e("div",_e,i(s.startingLocation),1),t[15]||(t[15]=e("div",{class:"flex-1"},null,-1)),e("div",De,i(s.dropoffLocation),1)])]),e("div",ke,[e("span",null,"Driver: "+i(s.driverName),1)]),e("div",Pe,[e("button",{onClick:k=>L(s.rideID),class:"px-4 py-2 border border-red-500 text-red-500 rounded-full text-sm"}," Cancel Request ",8,$e)])]))])}),128))]))])):p("",!0),f.value==="history"?(n(),a("div",Re,[_.value?(n(),a("div",Ue,t[17]||(t[17]=[e("svg",{class:"animate-spin h-12 w-12 text-[#C77DFF]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"})],-1)]))):c.value?(n(),a("div",je,[$(i(c.value)+" ",1),e("button",{onClick:D,class:"block mx-auto mt-4 text-[#C77DFF] underline"},"Try Again")])):m.value.length===0?(n(),a("div",Me,[w(u,{icon:"fa-car",class:"text-gray-300 text-5xl mb-4"}),t[18]||(t[18]=e("p",{class:"text-gray-500"},"No ride history found",-1)),((o=C(l).currentUser)==null?void 0:o.role)==="passenger"?(n(),a("button",{key:0,onClick:t[4]||(t[4]=s=>r.$router.push("/find-ride")),class:"mt-4 px-4 py-2 bg-[#C77DFF] text-white rounded-full text-sm"}," Find a Ride ")):((v=C(l).currentUser)==null?void 0:v.role)==="driver"?(n(),a("button",{key:1,onClick:t[5]||(t[5]=s=>r.$router.push("/create-ride")),class:"mt-4 px-4 py-2 bg-[#C77DFF] text-white rounded-full text-sm"}," Create a Ride ")):p("",!0)])):(n(),a("div",Ae,[(n(!0),a(N,null,H(m.value,(s,g)=>{var y,k,z;return n(),a("div",{key:g,class:"border border-gray-200 rounded-xl p-4 shadow-sm"},[e("div",Te,[e("span",{class:P(["text-xs rounded-full px-3 py-1 font-medium",E(s.status)])},i(B(s.status)),3)]),e("div",qe,[e("div",ze,i(M(s.requestTime)),1),t[20]||(t[20]=A('<div class="flex flex-col items-center justify-center h-14 relative" data-v-e1159576><div class="w-1 h-14 bg-[#C77DFF] absolute left-1/2 top-0 -translate-x-1/2 z-0" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div><div class="flex-1" data-v-e1159576></div><div class="w-3 h-3 rounded-full bg-[#C77DFF] z-10" data-v-e1159576></div></div>',1)),e("div",Ne,[e("div",He,i(s.startingLocation),1),t[19]||(t[19]=e("div",{class:"flex-1"},null,-1)),e("div",Ie,i(s.dropoffLocation),1)])]),e("div",Le,[e("div",null,i(V(s.requestTime)),1),((y=C(l).currentUser)==null?void 0:y.role)==="passenger"?(n(),a("div",Se,[e("div",null,"Driver: "+i(s.driverName||"Unknown"),1),s.carType?(n(),a("div",Ye,[$(i(s.carType)+" ",1),s.carColor?(n(),a("span",Ve,"("+i(s.carColor)+")",1)):p("",!0)])):p("",!0)])):(n(),a("div",Be,[e("span",null,"Seats: "+i(s.passengerCount),1)]))]),["pending","approved","accepted","active"].includes(s.status)||((k=C(l).currentUser)==null?void 0:k.role)==="driver"?(n(),a("button",{key:0,onClick:J=>q(s),class:"mt-3 w-full py-2 rounded-full text-[#C77DFF] border border-[#C77DFF] text-sm font-medium hover:bg-[#F8F0FF] transition"}," View Details ",8,Ee)):p("",!0),((z=C(l).currentUser)==null?void 0:z.role)==="passenger"&&!["pending","approved","accepted","active"].includes(s.status)?(n(),a("button",{key:1,onClick:J=>q(s),class:"mt-3 w-full py-2 rounded-full text-[#C77DFF] border border-[#C77DFF] text-sm font-medium hover:bg-[#F8F0FF] transition"}," View Details ",8,Je)):p("",!0)])}),128))])),m.value.length>0?(n(),a("div",Oe,[e("div",We,[e("button",{onClick:Y,disabled:d.value.currentPage<=1,class:P(["px-4 py-2 rounded-full text-sm font-medium transition-colors",d.value.currentPage<=1?"text-gray-400 cursor-not-allowed":"text-[#C77DFF] hover:bg-white hover:shadow-sm"])},[w(u,{icon:"fa-chevron-left",class:"mr-1"}),t[21]||(t[21]=$(" Prev "))],10,Ge),e("span",Ke,i(d.value.currentPage)+" / "+i(d.value.totalPages),1),e("button",{onClick:S,disabled:!d.value.nextPage,class:P(["px-4 py-2 rounded-full text-sm font-medium transition-colors",d.value.nextPage?"text-[#C77DFF] hover:bg-white hover:shadow-sm":"text-gray-400 cursor-not-allowed"])},[t[22]||(t[22]=$(" Next ")),w(u,{icon:"fa-chevron-right",class:"ml-1"})],10,Qe)])])):p("",!0)])):p("",!0)])])}}},et=O(Xe,[["__scopeId","data-v-e1159576"]]);export{et as default};
